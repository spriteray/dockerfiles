# 拉取最新的ubuntu
FROM ubuntu:latest

# 打开完整版
RUN bash -c 'yes | unminimize'
# 打开时区设置
ENV TZ=Asia/Shanghai
RUN mkdir -p /usr/src
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo '$TZ' > /etc/timezone

# 维护者
MAINTAINER spriteray spriteray@gmail.com

# 更新apt
RUN apt update
# 安装系统环境
RUN apt install -y build-essential openssh-server openssh-client net-tools sudo curl cmake
RUN apt install -y zsh git gdb tmux vim bash-completion language-pack-en
# 安装开发环境
RUN apt install -y libssl-dev libpython3-dev python3-dev man
# 安装帮助手册
RUN apt install -y manpages-de  manpages-de-dev  manpages-dev glibc-doc manpages-posix-dev manpages-posix manpages-zh

# 映射宿主机的文件系统
VOLUME /data

# 指定对外服务的端口号
EXPOSE 22 8001 8011 10712

# 使用代理
# ENV http_proxy=http://172.21.200.90:9999

# YCM
RUN git clone https://github.com/ycm-core/YouCompleteMe.git /usr/src/YouCompleteMe \
		&& cd /usr/src/YouCompleteMe \
		&& git submodule update --init --recursive \
		&& ./install.py  --clangd-completer

# tmux
RUN git clone https://github.com/gpakosz/.tmux.git && ln -s .tmux/.tmux.conf .tmux.conf && cp .tmux/.tmux.conf.local .tmux.conf.local

# 编码
RUN update-locale
RUN localectl set-locale LANG=zh_CN.UTF-8

# 增加用户
RUN groupadd -r develop
RUN useradd -s /bin/zsh -m -N -G develop,sudo ryan

# 切换用户
USER ryan
WORKDIR /home/ryan

# 安装oh-my-zsh
RUN ["/usr/bin/curl", "-fsSL", "https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh"]

# 拉取dotvim
RUN git clone https://github.com/spriteray/dotvim.git
RUN cp dotvim/_vimrc ._vimrc
RUN cp dotvim/.dircolors .dircolors
RUN cp dotvim/_gitconfig .gitconfig
RUN cp -r dotvim/vimfiles .vim
RUN ln -s /usr/src/YouCompleteMe .vim/bundle/YouCompleteMe

# 后续操作
# 安装vim插件: PlugInstall
# 修改zsh配置

# 指令
# docker run -itd -v workspace:/data --privileged -p 22:22 --name workspace ubuntu-workspace:v1
# docker run -itd -v /data --privileged -p 22:22 --name workspace ubuntu
# docker commit -m "develop workspace" 260d067248bf ubuntu-workspace:v1
# docker tag ubuntu-workspace:v1 spriteray/workspace:v1
# docker push spriteray/workspace:v1
